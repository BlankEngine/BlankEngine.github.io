const AsyncFunction=(async()=>{}).constructor;Application.Bind(async()=>{Debug.Set(BlankEngine.Inner.buildData.debugMode),await SceneManager.Load(0)},()=>{Input.Terminate(),SceneManager.Unload(),Resources.Unload(),this.htmlCanvas.style.display="none"});Object.prototype.name=null,Object.prototype.toString=function(){return this.name};class Resources{static#e=[];static#t=[];static async#n(name,type,data){const dat=data??{};let object=null;const libs=BlankEngine.Inner.compiledData.libs,scripts=BlankEngine.Inner.compiledData.scripts;let foundClass=!1,construction=null,properties=[];for(let e=0;e<libs.length;e++)for(let t=0;t<libs[e].scripts.length;t++)if(null!=libs[e].scripts[t].classes)for(let n=0;n<libs[e].scripts[t].classes.length;n++)if(libs[e].scripts[t].classes[n].name===type&&1===libs[e].scripts[t].classes[n].type){construction=libs[e].scripts[t].classes[n].construction,properties=libs[e].scripts[t].classes[n].args,foundClass=!0;break}for(let e=0;e<scripts.length;e++)if(null!=scripts[e].classes)for(let t=0;e<scripts[e].classes.length;t++)if(scripts[e].classes[t].name===type&&1===scripts[e].classes[t].type){construction=scripts[e].classes[t].construction,properties=scripts[e].classes[t].args,foundClass=!0;break}if(!foundClass)return new Object;if(null!=construction){const e=new AsyncFunction("data","toObject",construction);object=await e(dat,(async(e,t)=>await SceneManager.CreateObject(e,t)))}for(let i=0;i<properties.length;i++){if("object"!=typeof properties[i]||void 0===eval(`dat.${properties[i].name}`))continue;let subObj=null;if(null!=properties[i].evaluation){const evalCall=new AsyncFunction("data",properties[i].evaluation);subObj=await evalCall(eval(`dat.${properties[i].name}`))}else if(null!=properties[i].evalType){const evalCall=new AsyncFunction("data",properties[i].evalType);subObj=await eval(`SceneManager.CreateObject(${await evalCall(eval(`dat.${properties[i].name}`))}, ${eval(`dat.${properties[i].name}`)})`)}else subObj=["boolean","number","string","object"].includes(properties[i].type)?eval(`dat.${properties[i].name}`):"array"===properties[i].type?await SceneManager.CreateObjectArray(eval(`dat.${properties[i].name}`)):await eval(`SceneManager.CreateObject(${properties[i].type}, ${eval(`dat.${properties[i].name}`)})`);subObj=eval(`dat.${properties[i].name}`),eval(`object.${properties[i].name} = subObj`)}return null!=name&&(object.name=name),object}static#s(e,t){let n=[],s=[this.#t],l={final:[],sub:[]};for(let t=0;t<e.length-1&&(0!==s[s.length-1].length&&1!==e.length);t++)if(0!==t)for(let l=0;l<s[t].content.length;l++)"subpath"===s[t].content[l].type&&s[t].content[l].name===e[t]&&(n.push(l),s.push(s[t].content[l]));else for(let t=0;t<s[0].length;t++)"subpath"===s[0][t].type&&s[0][t].name===e[0]&&(n[0]=t,s.push(s[0][t]));"subpath"===t.type?s.push({name:t.name,type:"subpath",content:[]}):s.push(t);for(let e=s.length-1;e>0;e--){if(0===l.sub.length?l.sub[0]=s[e]:l.sub.push({name:s[e].name,type:"subpath",content:[]}),e===s.length-1)continue;let t=!1;0===s[e].content.length&&(l.sub[l.sub.length-1].content[0]=l.sub[l.sub.length-2]);for(let a=0;a<s[e].content.length;a++)(t||a!==n[e]&&null!=n[e]||(0===l.sub[l.sub.length-1].content.length?l.sub[l.sub.length-1].content[0]=l.sub[l.sub.length-2]:l.sub[l.sub.length-1].content.push(l.sub[l.sub.length-2]),t=!0,a!==n[e]))&&(0===l.sub[l.sub.length-1].content.length?l.sub[l.sub.length-1].content[0]=s[e].content[a]:l.sub[l.sub.length-1].content.push(s[e].content[a]))}0===s[0].length&&(l.final[0]=l.sub[l.sub.length-1]);let a=!1;for(let e=0;e<s[0].length;e++)(a||e!==n[0]&&0!==n.length||(0===l.final.length?l.final[0]=l.sub[l.sub.length-1]:l.final.push(l.sub[l.sub.length-1]),a=!0,e!==n[0]))&&(0===l.final.length?l.final[0]=s[0][e]:l.final.push(s[0][e]));this.#t=l.final}static Set(e){this.UnloadAll(),this.#e=e}static async Load(e){let t=[""],n=this.#e,s=[];for(let n=0;n<e.length;n++)"/"!==e[n]?t[t.length-1]+=e[n]:t.push("");for(let e=0;e<t.length;e++){let l=this.#t;0===s.length?s[0]=t[e]:s.push(t[e]);for(let n=1;n<=e;n++)for(let n=0;n<l.length;n++)l[n].name===t[e-1]&&"subpath"===l[n].type&&(l=l[n].content);for(let a=0;a<n.length;a++){if(t[e]!==n[a].name)continue;let i=0;for(let n=0;n<l.length;n++)t[e]===l[n].name&&(i=0!==i?3:"subpath"===l[n].type?1:2);if(e===t.length-1){if(2===i||3===i)return;return void this.#s(s,await this.#n(n[a].name,n[a].type,n[a].args))}if(1===i||3===i){n=n[a].content;break}this.#s(s,n[a]),n=n[a].content;break}}}static Unload(e){let t=[""],n=[],s=[this.#t],l={final:[],sub:[]};for(let n=0;n<e.length;n++)"/"!==e[n]?t[t.length-1]+=e[n]:t.push("");for(let e=0;e<t.length;e++)if(0!==e){if(0===s[s.length-1].content.length)return;for(let a=0;a<s[e].content.length;a++){if(e===t.length-1){if(a===s[e].content.length-1&&("subpath"===s[e].content[a].type||s[e].content[a].name!==t[e]))return;if("subpath"===s[e].content[a].type||s[e].content[a].name!==t[e])continue}else{if(a===s[e].content.length-1&&("subpath"!==s[e].content[a].type||s[e].content[a].name!==t[e]))return;if("subpath"!==s[e].content[a].type||s[e].content[a].name!==t[e])continue}n.push(a),e!==l.length-1&&s.push(s[e].content[a])}}else{if(0===s[0].length)return;for(let l=0;l<s[0].length;l++){if(e===t.length-1){if(l===s[0].length-1&&("subpath"===s[0][l].type||s[0][l].name!==t[0]))return;if("subpath"===s[0][l].type||s[0][l].name!==t[0])continue}else{if(l===s[0].length-1&&("subpath"!==s[0][l].type||s[0][l].name!==t[0]))return;if("subpath"!==s[0][l].type||s[0][l].name!==t[0])continue}n[0]=l,e!==t.length-1&&s.push(s[0][l])}}for(let e=s.length-2;e>0;e--){0===l.sub.length?l.sub[0]={name:s[e].name,type:"subpath",content:[]}:l.sub.push({name:s[e].name,type:"subpath",content:[]});for(let t=0;t<s[e].content.length;t++)if(e!==s.length-2||t!==n[e])if(t!==n[e])0===l.sub[l.sub.length-1].content.length?l.sub[l.sub.length-1].content[0]=s[e].content[t]:l.sub[l.sub.length-1].content.push(s[e].content[t]);else{if(0===l.sub[l.sub.length-2].content.length)continue;0===l.sub[l.sub.length-1].content.length?l.sub[l.sub.length-1].content[0]=l.sub[l.sub.length-2]:l.sub[l.sub.length-1].content.push(l.sub[l.sub.length-2])}}for(let e=0;e<s[0].length;e++)if(1!==s.length||e!==n[0])if(e!==n[0])0===l.final.length?l.final[0]=s[0][e]:l.final.push(s[0][e]);else{if(0===l.sub[l.sub.length-1].content.length)continue;0===l.final.length?l.final[0]=l.sub[l.sub.length-1]:l.final.push(l.sub[l.sub.length-1])}this.#t=l.final}static UnloadAll(){this.#t=[]}static Find(e){let t=[""],n=this.#t;for(let n=0;n<e.length;n++)"/"!==e[n]?t[t.length-1]+=e[n]:t.push("");for(let e=0;e<t.length;e++)for(let s=0;s<n.length;s++)if(n[s].name===t[e]){if(e===t.length-1)return"subpath"===n[s].type?new Object:n[s];n=n[s].content;break}return new Object}}class Debug{static#e=!1;static get isDebugMode(){return this.#e}static Set(e){this.#e=e}}class Time{static unscaledTime=0;static unscaledDeltaTime=0;static timeScale=1;static frameCount=0;static time=0;static deltaTime=0;static maximumDeltaTime=.3333333;static fixedUnscaledTime=0;static fixedUnscaledDeltaTime=0;static fixedTime=0;static fixedDeltaTime=.02}class Input{static#t=!1;static#e=!1;static#i=!1;static#s=[];static#n=class{name="";code="";active=!1;lastState=!1;constructor(t,e){this.name=t,this.code=e}};static#r(t){for(let e=0;e<this.#s.length;e++)if(this.#s[e].name===t)return e;return null}static#a(t){for(let e=0;e<this.#s.length;e++)if(this.#s[e].code===t)return e;return null}static Init(){this.#s=[new this.#n("up","ArrowUp"),new this.#n("down","ArrowDown"),new this.#n("left","ArrowLeft"),new this.#n("right","ArrowRight"),new this.#n("shift","Shift"),new this.#n("f4","F4")],document.addEventListener("keydown",(t=>{if(!document.hasFocus()||this.#i)return;const e=this.#a(t.key);null!=e&&(t.preventDefault(),this.#s[e].active=!0)})),document.addEventListener("keyup",(t=>{if(!document.hasFocus()||this.#i)return;const e=this.#a(t.key);null!=e&&(t.preventDefault(),this.#s[e].active=!1)}))}static Terminate(){this.#e=!0}static Update(){this.#i}static End(){if(!this.#i){for(let t=0;t<this.#s.length;t++)this.#s[t].lastState=this.#s[t].active;this.#e&&(this.#i=!0)}}static GetKey(t){let e=t;if("string"==typeof t){if(e=this.#r(t),null==e)return!1}else if(t<0||t>=this.#s.length)return;return this.#s[e].active}static GetKeyDown(t){let e=t;if("string"==typeof t){if(e=this.#r(t),null==e)return!1}else if(t<0||t>=this.#s.length)return;return this.#s[e].active&&!this.#s[e].lastState}static GetKeyUp(t){let e=t;if("string"==typeof t){if(e=this.#r(t),null==e)return!1}else if(t<0||t>=this.#s.length)return;return!this.#s[e].active&&this.#s[e].lastState}}class KeyCode{static get ArrowUp(){return 0}static get ArrowDown(){return 1}static get ArrowLeft(){return 2}static get ArrowRight(){return 3}static get Shift(){return 4}static get F4(){return 5}}class Component{gameObject=null;get transform(){return this.gameObject.transform}set transform(e){this.gameObject.transform=e}BroadcastMessage(method,params,data){if(!gameObject.activeSelf)return;const components=this.gameObject.components;let args="",dat=data??{};if(Array.isArray(params))for(let e=0;e<params.length;e++)args+=`params[${e}]`,e!==params.length-1&&(args+=",");else args=params;for(let i=0;i<components.length;i++)components[i].enabled&&components[i]instanceof GameBehavior&&(eval(`components[i].${method}(${args})`),dat.clearAfter&&eval(`components[i].${method} = () => { }`),components[i].gameObject=this.gameObject,components[i].name=this.name)}}class Behavior extends Component{enabled=!0;get isActiveAndEnabled(){return this.gameObject.activeSelf&&this.enabled}constructor(){super()}}class GameBehavior extends Behavior{constructor(){super()}Awake(){}OnEnable(){}Start(){}FixedUpdate(){}Update(){}LateUpdate(){}OnPreRender(){}OnRenderObject(){}OnPostRender(){}OnRenderImage(){}OnApplicationQuit(){}OnDisable(){}OnDestroy(){}}Math.Clamp=function(t,n,a){let e=t;return e<n&&(e=n),e>a&&(e=a),e};class Matrix3x3{matrix=[[1,0,0],[0,1,0],[0,0,1]];static get zero(){return new Matrix3x3([0,0,0],[0,0,0],[0,0,0])}static get identity(){return new Matrix3x3([1,0,0],[0,1,0],[0,0,1])}get determinant(){const t=this.matrix;return t[0][0]*(t[1][1]*t[2][2]-t[2][1]*t[1][2])-t[1][0]*(t[0][1]*t[2][2]-t[2][1]*t[0][2])+t[2][0]*(t[0][1]*t[1][2]-t[1][1]*t[0][2])}get transpose(){const t=this.matrix;return new Matrix3x3([t[0][0],t[1][0],t[2][0]],[t[0][1],t[1][1],t[2][1]],[t[0][2],t[1][2],t[2][2]])}get inverse(){const t=1/this.determinant;if(0===t)return Matrix3x3.zero;const e=this.transpose.matrix;return new Matrix3x3([t*(e[1][1]*e[2][2]-e[2][1]*e[1][2]),t*(e[1][2]*e[2][0]-e[2][2]*e[1][0]),t*(e[1][0]*e[2][1]-e[2][0]*e[1][1])],[t*(e[0][2]*e[2][1]-e[2][2]*e[0][1]),t*(e[0][0]*e[2][2]-e[2][0]*e[0][2]),t*(e[0][1]*e[2][0]-e[2][1]*e[0][0])],[t*(e[0][1]*e[1][2]-e[1][1]*e[0][2]),t*(e[0][2]*e[1][0]-e[1][2]*e[0][0]),t*(e[0][0]*e[1][1]-e[1][0]*e[0][1])])}constructor(t,e,r){this.matrix=[t??[1,0,0],e??[0,1,0],r??[0,0,1]]}static Translate(t){return new Matrix3x3([1,0,0],[0,1,0],[t.x,t.y,1])}static Rotate(t){return new Matrix3x3([Math.cos(t),Math.sin(t),0],[-Math.sin(t),Math.cos(t),0],[0,0,1])}static Scale(t){return new Matrix3x3([t.x,0,0],[0,t.y,0],[0,0,1])}static TRS(t,e,r){return new Matrix3x3([Math.cos(e)*r.x,Math.sin(e)*r.y,0],[-Math.sin(e)*r.x,Math.cos(e)*r.y,0],[t.x,t.y,1])}static Ortho(t,e,r,a){return new Matrix3x3([2/(e-t),0,0],[0,2/(a-r),0],[-(e+t)/(e-t),-(a+r)/(a-r),1])}static Multiply(t,e){const r=t.matrix,a=e.matrix;return new Matrix3x3([r[0][0]*a[0][0]+r[1][0]*a[0][1]+r[2][0]*a[0][2],r[0][1]*a[0][0]+r[1][1]*a[0][1]+r[2][1]*a[0][2],r[0][2]*a[0][0]+r[1][2]*a[0][1]+r[2][2]*a[0][2]],[r[0][0]*a[1][0]+r[1][0]*a[1][1]+r[2][0]*a[1][2],r[0][1]*a[1][0]+r[1][1]*a[1][1]+r[2][1]*a[1][2],r[0][2]*a[1][0]+r[1][2]*a[1][1]+r[2][2]*a[1][2]],[r[0][0]*a[2][0]+r[1][0]*a[2][1]+r[2][0]*a[2][2],r[0][1]*a[2][0]+r[1][1]*a[2][1]+r[2][1]*a[2][2],r[0][2]*a[2][0]+r[1][2]*a[2][1]+r[2][2]*a[2][2]])}GetValue(t,e){return this.matrix[t][e]}SetValue(t,e,r){this.matrix[t][e]=r}GetColumn(t){let e=[0,0,0];for(let r=0;r<=2;r++)e[r]=this.GetValue(t,r);return e}SetColumn(t,e){for(let r=0;r<=2;r++)this.SetValue(t,r,e[r])}GetRow(t){let e=[0,0,0];for(let r=0;r<=2;r++)e[r]=this.GetValue(r,t);return e}SetRow(t,e){for(let r=0;r<=2;r++)this.SetValue(r,t,e[r])}}class Vector2{static get zero(){return new Vector2(0,0)}static get one(){return new Vector2(1,1)}static get up(){return new Vector2(0,1)}static get down(){return new Vector2(0,-1)}static get left(){return new Vector2(-1,0)}static get right(){return new Vector2(1,0)}x=0;y=0;get magnitude(){return Math.sqrt(this.sqrMagnitude)}get sqrMagnitude(){return this.x*this.x+this.y*this.y}get normalized(){return new Vector2(this.x/this.magnitude||0,this.y/this.magnitude||0)}constructor(t,e){this.Set(t??0,e??0)}static Distance(t,e){return Math.sqrt((t.x-e.x)**2+(t.y-e.y)**2)}static Dot(t,e){return t.x*e.x+t.y*e.y}static Min(t,e){return new Vector2(Math.min(t.x,e.x),Math.min(t.y,e.y))}static Max(t,e){return new Vector2(Math.max(t.x,e.x),Math.max(t.y,e.y))}static Add(t,e){return"number"==typeof e?new Vector2(t.x+e,t.y+e):new Vector2(t.x+e.x,t.y+e.y)}static Subtract(t,e){return"number"==typeof e?new Vector2(t.x-e,t.y-e):new Vector2(t.x-e.x,t.y-e.y)}static Scale(t,e){return"number"==typeof e?new Vector2(t.x*e,t.y*e):new Vector2(t.x*e.x,t.y*e.y)}static Divide(t,e){return"number"==typeof e?new Vector2(t.x/e,t.y/e):new Vector2(t.x/e.x,t.y/e.y)}Set(t,e){this.x=t,this.y=e}toString(){return`(${this.x}, ${this.y})`}Equals(t){return this.x==t.x&&this.y==t.y}Normalize(){const t=this.magnitude;this.x=this.x/t||0,this.y=this.y/t||0}}class Color{r=0;g=0;b=0;a=1;get grayscale(){let t=.3*this.r+.59*this.g+.11*this.b;return new Color(t,t,t,this.a)}constructor(t,s,i,r){this.Set(t??0,s??0,i??0,r??1)}Set(t,s,i,r){this.r=t,this.g=s,this.b=i,null!=r&&(this.a=r)}toString(){return`${this.r}, ${this.g}, ${this.b}, ${this.a}`}}class Rect{x=0;y=0;width=1;height=1;xMin=0;yMin=0;center=new Vector2;get xMax(){return this.width}set xMax(t){this.width=t}get yMax(){return this.height}set yMax(t){this.height=t}get position(){return new Vector2(this.x,this.y)}set position(t){this.x=t.x,this.y=t.y}get size(){return new Vector2(this.width,this.height)}set size(t){this.width=t.x,this.height=t.y}constructor(t,i,h,e){this.Set(t??0,i??0,h??1,e??1)}Set(t,i,h,e){this.x=t,this.y=i,this.width=h,this.height=e}toString(){return`${this.x}, ${this.y}, ${this.width}, ${this.height}`}}class Ray{#i=null;origin=null;get direction(){return this.#i}set direction(i){this.#i=i.normalized}constructor(i,t){this.origin=i??Vector2.zero,this.direction=t??Vector2.zero}GetPoint(i){return Vector2.Add(this.origin,Vector2.Scale(this.#i,i))}toString(){return`Origin: ${this.origin.toString()}, Dir: ${this.#i.toString()}`}}class Bounds{center=null;extents=null;get size(){return Vector2.Scale(this.extents,2)}set size(t){this.extents=Vector2.Scale(t,.5)}get min(){return Vector2.Subtract(this.center,this.extents)}set min(t){this.SetMinMax(t,this.max)}get max(){return Vector2.Add(this.center,this.extents)}set max(t){this.SetMinMax(this.min,t)}constructor(t,e){this.center=t??Vector2.zero,this.size=e??Vector2.one}Contains(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y}ClosestPoint(t){return new Vector2(Math.clamp(t.x,this.min.x,this.max.x),Math.clamp(t.y,this.min.y,this.max.y))}Expand(t){this.extents="number"==typeof t?Vector2.Add(this.extents,.5*t):Vector2.Add(this.extents,Vector2.Scale(t,.5))}Intersects(t){return t.min.x<=this.max.x&&t.max.x>=this.min.x&&t.min.y<=this.max.y&&t.max.y>=this.min.y}SetMinMax(t,e){this.extents=Vector2.Scale(Vector2.Subtract(e,t),.5),this.center=Vector2.Add(t,this.extents)}SqrDistance(t){const e=this.ClosestPoint(t);return(t.x-e.center.x)**2+(t.y-e.center.y)**2}toString(){return`Center: ${this.center.toString()}, Extents: ${this.extents.toString()}`}}class Transform extends Component{position=new Vector2;rotation=0;scale=new Vector2;get localToWorldMatrix(){return Matrix3x3.TRS(this.position,.005555555555555556*this.rotation*Math.PI,this.scale)}get worldToLocalMatrix(){return localToWorldMatrix.inverse}constructor(o,t,r){super(),this.position=o??Vector2.zero,this.rotation=t??0,this.scale=r??Vector2.one}}class GameObject{#t="Empty Object";#e=!1;#n=[];get name(){return this.#t}set name(t){this.#t=t;const e=this.#n;for(let t=0;t<this.#n.length;t++)e[t].name=this.name}get activeSelf(){return this.#e}get components(){return this.#n}set components(t){let e=[this.#n[0]];for(let n=0;n<t.length;n++)e.push(t[n]);this.#n=e;for(let t=0;t<this.#n.length;t++)this.#n[t].gameObject=this,this.#n[t].name=this.name}get transform(){return this.#n[0]}set transform(t){this.#n[0]=t,this.#n[0].gameObject=this,this.#n[0].name=this.name}constructor(t,e,n,s){this.name=t??"Empty Object",this.#e=n??!0,this.transform=s??new Transform,this.components=e??[]}SetActive(t){this.#e=t}BroadcastMessage(method,params,data){if(!this.#e)return;const components=this.#n;let args="",dat=data??{};if(Array.isArray(params))for(let t=0;t<params.length;t++)args+=`params[${t}]`,t!==params.length-1&&(args+=",");else args=params;for(let i=0;i<components.length;i++)components[i].enabled&&components[i]instanceof GameBehavior&&(eval(`components[i].${method}(${args})`),dat.clearAfter&&eval(`components[i].${method} = () => { }`),components[i].gameObject=this,components[i].name=this.name)}GetComponents(type){const components=this.#n;let newComps=[];for(let i=0;i<components.length;i++)eval(`components[i] instanceof ${type}`)&&(components[i]instanceof Behavior&&!components[i].enabled||(0===newComps.length?newComps[0]=components[i]:newComps(components[i])));return newComps}}class SceneManager{static#e=[];static#t=null;static#s=!1;static#a=!1;static get sceneLoaded(){return this.#s}static get sceneUnloaded(){return this.#a}static GetActiveScene(){return this.#t??{isLoaded:!1}}static Set(e){this.#e=e}static Load(e){this.#t=new this.Scene(this.#e[e].name,{resources:this.#e[e].resources,gameObjects:this.#e[e].gameObjects,buildIndex:this.#e[e].buildIndex,path:this.#e[e].path})??new this.Scene,this.#s=!0}static Unload(){this.#t=new this.Scene}static async CreateObject(type,data){const dat=data??{};let object=null,keepName=!1;const libs=BlankEngine.Inner.compiledData.libs,scripts=BlankEngine.Inner.compiledData.scripts;let foundClass=!1,construction=null,properties=[];for(let e=0;e<libs.length;e++)for(let t=0;t<libs[e].scripts.length;t++)if(null!=libs[e].scripts[t].classes)for(let s=0;s<libs[e].scripts[t].classes.length;s++)if(libs[e].scripts[t].classes[s].name===type&&0===libs[e].scripts[t].classes[s].type){construction=libs[e].scripts[t].classes[s].construction,properties=libs[e].scripts[t].classes[s].args,foundClass=!0;break}for(let e=0;e<scripts.length;e++)if(null!=scripts[e].classes)for(let t=0;e<scripts[e].classes.length;t++)if(scripts[e].classes[t].name===type&&0===scripts[e].classes[t].type){construction=scripts[e].classes[t].construction,properties=scripts[e].classes[t].args,foundClass=!0;break}if(!foundClass)return new Object;if(null!=construction){const e=new AsyncFunction("data","toObject",construction),t=await e(dat,(async(e,t)=>await this.CreateObject(e,t)));keepName=t.keepName,object=t.object}else object=eval(`new ${type}()`);for(let i=0;i<properties.length;i++){if("object"!=typeof properties[i]||void 0===eval(`dat.${properties[i].name}`))continue;let subObj=null;if(null!=properties[i].evaluation){const evalCall=new AsyncFunction("data",properties[i].evaluation);subObj=await evalCall(eval(`dat.${properties[i].name}`))}else if(null!=properties[i].evalType){const evalCall=new AsyncFunction("data",properties[i].evalType);subObj=await eval(`this.CreateObject(${await evalCall(eval(`dat.${properties[i].name}`))}, ${eval(`dat.${properties[i].name}`)})`)}else subObj=["boolean","number","string","object"].includes(properties[i].type)?eval(`dat.${properties[i].name}`):"array"===properties[i].type?await this.CreateObjectArray(eval(`dat.${properties[i].name}`)):await eval(`this.CreateObject(${properties[i].type}, ${eval(`dat.${properties[i].name}`)})`);subObj=eval(`dat.${properties[i].name}`),eval(`object.${properties[i].name} = subObj`)}return null==dat.name||keepName||(object.name=dat.name),object}static async CreateObjectArray(e){let t=[];for(let s=0;s<e.length;s++){let a=null;a=Array.isArray(e[s])?await this.CreateObjectArray(e[s]):"object"==typeof e[s]&&e[s].__compiled?await this.CreateObject(e[s].type,e[s].args):e[s],0===t.length?t[0]=a:t.push(a)}return t}}SceneManager.Scene=class{#e=null;#t=!1;name="scene";gameObjects=[];get buildIndex(){return this.#e.buildIndex}get path(){return this.#e.path}get isLoaded(){return this.#t}constructor(e,t){this.name=e??"scene",this.#e=t??{},this.#a()}async#a(){this.#s(),await this.#n(),this.#t=!0}#s(){null==this.#e.resources&&(this.#e.resources=[]);for(let e=0;e<this.#e.resources.length;e++)Resources.Load(this.#e.resources[e])}async#n(){null==this.#e.gameObjects&&(this.#e.gameObjects=[]);let e=[];for(let t=0;t<this.#e.gameObjects.length;t++){let a=[];for(let e=0;e<this.#e.gameObjects[t].components.length;e++){let s=await SceneManager.CreateObject(this.#e.gameObjects[t].components[e].type,this.#e.gameObjects[t].components[e].args);0===a.length?a[0]=s:a.push(s)}const s=await SceneManager.CreateObject("GameObject",{name:this.#e.gameObjects[t].name,components:a,active:this.#e.gameObjects[t].active,transform:this.#e.gameObjects[t].transform});0===e.length?e[0]=s:e.push(s)}this.gameObjects=e}};class PlayerLoop{static#e=!1;static#t=[];static#a(){requestAnimationFrame(this.#i.bind(this))}static async#i(){if(this.#e||Application.isLoaded||(Application.Load(),this.#e=!0),!Application.isLoaded||!SceneManager.GetActiveScene().isLoaded)return this.#a();const e=this.#t;for(let t=0;t<e.length;t++)e[t].updateFunction();this.#a()}static Init(){if(this.#e)return;let e=!1;this.#t=[new PlayerLoopSystem("Initialization",{subSystemList:[new PlayerLoopSystem("ScriptRunBehaviorStart",{loopConditionFunction:()=>document.hasFocus(),updateDelegate:()=>{for(let e=0;e<SceneManager.GetActiveScene().gameObjects.length;e++)SceneManager.GetActiveScene().gameObjects[e].BroadcastMessage("Start",null,{clearAfter:!0})}})]}),new PlayerLoopSystem("TimeUpdate",{updateFunction:function(){const e=1/Application.targetFrameRate-.005;let t=.001*performance.now()-Time.unscaledTime;for(;t>=e;){Time.unscaledDeltaTime=.001*performance.now()-Time.unscaledTime,Time.unscaledTime+=Time.unscaledDeltaTime;let a=Time.unscaledDeltaTime;a>Time.maximumDeltaTime&&(a=Time.maximumDeltaTime),Time.deltaTime=a*Time.timeScale,Time.time+=Time.deltaTime,Time.frameCount+=Time.timeScale,this.updateDelegate();const i=this.subSystemList;for(let e=0;e<i.length;e++)i[e].updateFunction();t-=e}},updateDelegate:()=>{e=!0}}),new PlayerLoopSystem("EarlyUpdate",{loopConditionFunction:()=>e,subSystemList:[new PlayerLoopSystem("UpdateMainGameViewRect",{loopConditionFunction:()=>document.hasFocus()&&0!==Time.timeScale,updateDelegate:()=>{Application.gl.viewport(0,0,Application.htmlCanvas.width,Application.htmlCanvas.height),Application.gl.clear(Application.gl.COLOR_BUFFER_BIT|Application.gl.DEPTH_BUFFER_BIT),Application.gl.enable(Application.gl.BLEND),Application.gl.blendFunc(Application.gl.SRC_ALPHA,Application.gl.ONE_MINUS_SRC_ALPHA)}}),new PlayerLoopSystem("UpdateInputManager",{loopConditionFunction:()=>document.hasFocus()&&0!==Time.timeScale,updateDelegate:()=>{Input.Update()}})]}),new PlayerLoopSystem("FixedUpdate",{updateFunction:function(){Time.fixedDeltaTime;for(;Time.fixedTime<Time.time;){Time.fixedUnscaledDeltaTime=.001*performance.now()-Time.fixedUnscaledTime,Time.fixedUnscaledTime+=Time.fixedUnscaledDeltaTime,Time.fixedTime+=Time.fixedDeltaTime*Time.timeScale;const e=this.subSystemList;for(let t=0;t<e.length;t++)e[t].updateFunction()}},subSystemList:[new PlayerLoopSystem("ScriptRunBehaviorFixedUpdate",{loopConditionFunction:()=>document.hasFocus()&&0!==Time.timeScale,updateDelegate:()=>{for(let e=0;e<SceneManager.GetActiveScene().gameObjects.length;e++)SceneManager.GetActiveScene().gameObjects[e].BroadcastMessage("FixedUpdate")}})]}),new PlayerLoopSystem("Update",{loopConditionFunction:()=>e,subSystemList:[new PlayerLoopSystem("ScriptRunBehaviorUpdate",{loopConditionFunction:()=>document.hasFocus()&&0!==Time.timeScale,updateDelegate:()=>{for(let e=0;e<SceneManager.GetActiveScene().gameObjects.length;e++)SceneManager.GetActiveScene().gameObjects[e].BroadcastMessage("Update")}})]}),new PlayerLoopSystem("PreLateUpdate",{loopConditionFunction:()=>e,subSystemList:[new PlayerLoopSystem("ScriptRunBehaviorLateUpdate",{loopConditionFunction:()=>document.hasFocus()&&0!==Time.timeScale,updateDelegate:()=>{for(let e=0;e<SceneManager.GetActiveScene().gameObjects.length;e++)SceneManager.GetActiveScene().gameObjects[e].BroadcastMessage("LateUpdate")}})]}),new PlayerLoopSystem("PostLateUpdate",{loopConditionFunction:()=>!!e&&(e=!1,!0),subSystemList:[new PlayerLoopSystem("UpdateAllRenderers",{loopConditionFunction:()=>document.hasFocus()&&0!==Time.timeScale,updateDelegate:()=>{for(let e=0;e<SceneManager.GetActiveScene().gameObjects.length;e++){const t=SceneManager.GetActiveScene().gameObjects[e].GetComponents("Camera");for(let e=0;e<t.length;e++)t[e].Render()}Application.gl.flush()}}),new PlayerLoopSystem("UpdateAllRenderers",{loopConditionFunction:()=>document.hasFocus()&&0!==Time.timeScale,updateDelegate:()=>{Application.gl.flush()}}),new PlayerLoopSystem("InputEndFrame",{updateDelegate:()=>{Input.End()}})]})],this.#a()}}class PlayerLoopSystem{name="";loopConditionFunction=()=>!0;subSystemList=[];updateDelegate=()=>{};updateFunction=()=>{if(!this.loopConditionFunction())return;this.updateDelegate();const t=this.subSystemList;for(let n=0;n<t.length;n++)t[n].updateFunction()};constructor(t,n){this.name=t;const e=n??{};null!=e.loopConditionFunction&&(this.loopConditionFunction=e.loopConditionFunction),null!=e.subSystemList&&(this.subSystemList=e.subSystemList),null!=e.updateDelegate&&(this.updateDelegate=e.updateDelegate),null!=e.updateFunction&&(this.updateFunction=e.updateFunction)}}class Shader{static#e=[];static#t=!1;static get isLoaded(){return this.#t}#s=null;#h=null;get type(){return this.#s}get shader(){return this.#h}constructor(e,t,s){this.name=e,this.#s=s;const h=Application.gl;let a;switch(this.#s){case"VERTEX":a=h.VERTEX_SHADER;break;case"FRAGMENT":a=h.FRAGMENT_SHADER}this.#h=h.createShader(a),h.shaderSource(this.#h,t),h.compileShader(this.#h)}static Set(e){for(let t=0;t<e.length;t++){if(""===e[t])continue;let s=0,h="",a=["",""],i=0,r=!1,d="";for(let n=0;n<e[t].length;n++)if("/"!==e[t][n]||"/"!==e[t][n+1]){if(s>=4)break;if("\n"!==e[t][n])if("'"!==e[t][n]&&'"'!==e[t][n]){if(r||" "!==e[t][n])if(":"!==e[t][n])0===i?h+=e[t][n]:a[i-1]+=e[t][n];else{switch(i=-1,h){case"NAME":i=1;break;case"TYPE":i=2}h=""}}else{if(r&&e[t][n]===d){r=!1,d="";continue}r=!0,d=e[t][n]}}else s++,i=0,n++;const n=new Shader(a[0],e[t],a[1]);0===this.#e.length?this.#e[0]=n:this.#e.push(n)}this.#t=!0}static Find(e,t){for(let s=0;s<this.#e.length;s++)if((null==t||this.#e[s].type===t)&&this.#e[s].name===e)return this.#e[s];return this.Find("Default/Standard",t)}}class Material{#r=null;#t=null;get gl(){return this.#r}get program(){return this.#t}constructor(r,t){this.#r=Application.gl;const a=r??Shader.Find("Default/Standard","VERTEX"),h=t??Shader.Find("Default/Standard","FRAGMENT");this.#t=this.#r.createProgram(),this.#r.attachShader(this.#t,a.shader),this.#r.attachShader(this.#t,h.shader),this.#r.linkProgram(this.#t),this.#r.detachShader(this.#t,a.shader),this.#r.detachShader(this.#t,h.shader)}getAttribLocation(r){return this.#r.getAttribLocation(this.#t,r)}getUniformLocation(r){return this.#r.getUniformLocation(this.#t,r)}}class Texture{#i=!1;#t=null;wrapMode=0;filterMode=0;get isLoaded(){return this.#i}get img(){return this.#t}constructor(i){this.#t=new Image,this.#t.src=`img/${i}`,this.#t.sprite=this,this.#t.onload=()=>{this.#i=!0}}}class Sprite{texture=null;rect=null;constructor(t,e){this.texture=t,this.rect=e??new Rect}}class Camera extends Behavior{#t=!0;#e=null;orthographic=!0;orthographicSize=1;get projectionMatrix(){return this.#e}set projectionMatrix(t){this.#t=!1,this.projMatrix=t}get worldToCameraMatrix(){const t=this.gameObject.transform;return Matrix3x3.TRS(t.position,.005555555555555556*-t.rotation*Math.PI,t.scale)}get cameraToWorldMatrix(){return this.worldToCameraMatrix.inverse}constructor(){super()}Render(){const t=this.worldToCameraMatrix;this.#t&&this.orthographic&&(this.#e=Matrix3x3.Ortho(0,this.orthographicSize,0,this.orthographicSize));const e=new Vector2(1/(Application.htmlCanvas.width/Application.htmlCanvas.height),-1),r=Matrix3x3.TRS(e,0,e);for(let e=0;e<SceneManager.GetActiveScene().gameObjects.length;e++){if(!SceneManager.GetActiveScene().gameObjects[e].activeSelf)continue;const a=SceneManager.GetActiveScene().gameObjects[e].GetComponents("SpriteRenderer");for(let e=0;e<a.length;e++){let i=a[e].gameObject.transform.localToWorldMatrix;i.matrix[2][1]*=-1,i.matrix[2][0]*=-1;let o=Matrix3x3.Multiply(Matrix3x3.Multiply(Matrix3x3.Multiply(r,this.#e),t),i);o.matrix[2][0]*=-1,a[e].localSpaceMatrix=o,a[e].Render()}}}}class SpriteRenderer extends Component{#t=!1;#e=null;#i=null;#r=null;#a=null;#s=null;#l=null;#o=null;#u=null;#n=null;#h=null;#x=null;#m=null;localSpaceMatrix=new Matrix3x3;get isLoaded(){return this.#t}get sprite(){return this.#i}set sprite(t){this.#e=t,this.CheckImg()}get material(){return this.#a}set material(t){this.#r=t,this.CheckImg()}constructor(t,e){super(),this.#e=t,this.#r=e??new Material,this.CheckImg()}CheckImg(){requestAnimationFrame((()=>{if(this.#e.texture.isLoaded)return this.Load();this.CheckImg()}))}Load(){const t=this.#e.texture,e=this.#r.gl,i=this.#e.rect,r=i.x,a=i.y,s=i.width,l=i.height,o=i.xMin,u=i.yMin,n=[r+o,a+u,r+s,a+u,r+s,a+l,r+o,a+u,r+o,a+l,r+s,a+l];let h,x;if(1===t.filterMode)h=e.NEAREST;else h=e.LINEAR;switch(t.wrapMode){case 1:x=e.REPEAT;break;case 2:x=e.MIRRORED_REPEAT;break;default:x=e.CLAMP_TO_EDGE}e.useProgram(this.#r.program),this.#s=e.createTexture(),this.#l=e.createBuffer(),this.#o=e.createBuffer(),this.#u=this.#r.getUniformLocation("uSampler"),this.#n=this.#r.getUniformLocation("uLocalMatrix"),this.#h=this.#r.getUniformLocation("uVertexPositionOffset"),this.#x=this.#r.getAttribLocation("aVertexPosition"),this.#m=this.#r.getAttribLocation("aTexturePosition"),e.bindTexture(e.TEXTURE_2D,this.#s),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,x),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,x),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,h),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,h),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t.img),e.bindTexture(e.TEXTURE_2D,null),e.bindBuffer(e.ARRAY_BUFFER,this.#o),e.bufferData(e.ARRAY_BUFFER,new Float32Array(n),e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this.#l),e.bufferData(e.ARRAY_BUFFER,new Float32Array(n),e.STATIC_DRAW),e.useProgram(null),this.#i=this.#e,this.#a=this.#r,this.#t=!0}Render(){if(!this.#t||!this.gameObject.activeSelf)return;const t=this.#a.gl,e=[this.localSpaceMatrix.matrix[0][0],this.localSpaceMatrix.matrix[0][1],this.localSpaceMatrix.matrix[0][2],this.localSpaceMatrix.matrix[1][0],this.localSpaceMatrix.matrix[1][1],this.localSpaceMatrix.matrix[1][2],this.localSpaceMatrix.matrix[2][0],this.localSpaceMatrix.matrix[2][1],this.localSpaceMatrix.matrix[2][2]];t.useProgram(this.#a.program),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this.#s),t.uniform1i(this.#u,0),t.bindBuffer(t.ARRAY_BUFFER,this.#o),t.enableVertexAttribArray(this.#x),t.vertexAttribPointer(this.#x,2,t.FLOAT,!1,0,0),t.uniformMatrix3fv(this.#n,!1,new Float32Array(e));const i=this.#i.rect.center;t.uniform2fv(this.#h,new Float32Array([-.5*(1+i.x),-.5*(1+i.y)])),t.bindBuffer(t.ARRAY_BUFFER,this.#l),t.enableVertexAttribArray(this.#m),t.vertexAttribPointer(this.#m,2,t.FLOAT,!1,0,0),t.drawArrays(t.TRIANGLE_STRIP,0,6),t.useProgram(null)}}